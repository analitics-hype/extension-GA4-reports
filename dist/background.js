chrome.runtime.onInstalled.addListener((()=>{chrome.storage.local.set({confidenceLevel:95,recentReports:[]})})),chrome.runtime.onMessage.addListener(((e,o,r)=>{if("saveReport"===e.action)return chrome.storage.local.get("recentReports",(o=>{const t=o.recentReports||[];t.unshift(e.report),t.length>10&&t.pop(),chrome.storage.local.set({recentReports:t},(()=>{r({success:!0})}))})),!0})),chrome.runtime.onInstalled.addListener((()=>{chrome.storage.local.set({confidenceLevel:95,recentReports:[]})})),chrome.runtime.onMessage.addListener(((e,o,r)=>{if("pageLoaded"===e.action){const o=e.url.includes("analytics.google.com");chrome.action.setIcon({path:{16:o?"images/icon16.png":"images/icon16_disabled.png",48:o?"images/icon48.png":"images/icon48_disabled.png",128:o?"images/icon128.png":"images/icon128_disabled.png"}}),chrome.action.setPopup({popup:o?"popup.html":"disabled.html"})}if("saveReport"===e.action)return chrome.storage.local.get("recentReports",(o=>{const t=o.recentReports||[];t.unshift(e.report),t.length>10&&t.pop(),chrome.storage.local.set({recentReports:t},(()=>{r({success:!0})}))})),!0})),chrome.storage.sync.get(["openaiApiKey"],(e=>{e.openaiApiKey||chrome.runtime.openOptionsPage()})),chrome.runtime.onError.addListener((e=>{console.error("Extension error:",e.message)}));